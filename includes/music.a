; Player
		
; Set origin point (must be the same as the last four bytes of !to)
		* = $4400
		
ED_M      LDA #<song
          STA $1E
          LDA #>song
          STA $1F

          LDA #1
          STA $09
          STA $1D

          PHA
          PHA
          PHA
          BNE H0A2B

H0A16     INY
          LDA ($1E),Y
          STA $09
          INY
          LDA ($1E),Y
          STA $1D

H0A20     LDA $1E
          CLC
          ADC #$03
          STA $1E
          BCC H0A2B
          INC $1F

H0A2B     LDY #$00
          LDA ($1E),Y
          CMP #$01
          BEQ H0A16
          BCS H0A45

          PLA
          PLA
          PLA
ED_AGAIN  LDA #$FF       ; [0=fin,1=recommence]
          BNE ED_M       ; reprise du d{but
          RTS            ; fin

H0A38     LDX #$49
          INY
          LDA ($1E),Y
          BNE EXIT
          LDX #$C9
EXIT      RTS

H0A45     STA $08
          JSR H0A38
          STX H0A94
          STA $06
          LDX $09
-         LSR
          DEX
          BNE -
          STA H0A8C+1
          JSR H0A38
          STX H0ACC
          STA $07
          LDX $1D
-         LSR
          DEX
          BNE -
          STA H0AC4+1


; Interruption par JSR autoris√©e ici

ED_INTER  JSR main_loop     ; adr interruption

ED_NOINTER PLA
          TAY
          PLA
          TAX
          PLA
          BNE H0A76

H0A73     BIT $C030
H0A76     CMP #0
          BMI H0A7D
          NOP
          BPL H0A80

H0A7D     BIT $C030

H0A80     STA $4E

NOKEY     DEY
          BNE H0A8C
          BEQ H0A92

H0A8C     CPY #$00
          BEQ H0A94
          BNE H0A96

H0A92     LDY $06
H0A94     EOR #$40
H0A96     BIT $4E
          BVC H0AA1
          BVS H0A9C
H0A9C     BPL H0AA7
          NOP
          BMI H0AAA
H0AA1     NOP
          BMI H0AA7
          NOP
          BPL H0AAA

H0AA7     CMP $C030
H0AAA     DEC $4F
          BNE H0ABF
          DEC $08
          BNE H0ABF
          BVC H0AB7
          BIT $C030
H0AB7     PHA
          TXA
          PHA
          TYA
          PHA
          JMP H0A20

H0ABF     DEX
          BNE H0AC4
          BEQ H0ACA

H0AC4     CPX #$00
          BEQ H0ACC
          BNE H0ACE

H0ACA     LDX $07
H0ACC     EOR #$80
H0ACE     BVS H0A73
          NOP
          BVC H0A76


song
	!binary "data/M.4EME.RDV"